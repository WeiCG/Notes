# 加密流量的精细化识别技术

> 2020年10月7日 魏晨光

## 采用的数据是学校信息中心的流量

该流量是实际的流量，不是实验室的流量，因此存在一定的问题：

1. 学校流量是实际应用中的流量，既存在非加密流量，也存在加密流量
2. 流量未经过清洗，一定会存在大量的未知流量，如何在未知数据下提高准确率，甚至如何不知道未知数据的前提下，将这些未知流量也正确的精细化识别出来
3. 同样 ，流量未经过清洗，那么在分类之后如何判断分类准确率呢？
4. 流量未经过清洗，如果进行异常流量检测，如何判断该加密流量是异常的？

## 方向 - 流量的精细化识别

### 加密流量与非加密流量的识别 - 首要问题

- 目前，加密流量在网络上占据的份额已经达到了百分之七十以上，同时这种趋势还在不断上涨。在可以预见的未来，加密流量在全部网络流量中所占的比例一定会超过百分之九十，甚至接近百分之百。在那个时候，就不再需要加密流量与非加密流量的识别了
- 但在如今实际的网络环境中，加密流量识别的很大一个问题就是非加密流量的干扰，通常一个在实验环境下能取得较高准确率的方法，在实际环境下准确率会大打折扣
- 校园网流量是实际流量，而不是实验室流量。因此首要问题就是如何从海量的校园网流量中识别出其中的加密流量和非加密流量

### 被加密的应用层协议识别

### 加密流量的应用识别

- 即该加密流量是在哪个应用中发出的
- 同一应用的加密流量，其数据包载荷的均值和方差会属于某一范围中
- 不同应用的加密流量，其数据包载荷的均值和方差有一定的差距
- 不同的网络协议产生的网络流量，其流级统计特征具有不同的分布，反映了各个协议独特的内在本质特性

### 使用SSL协议加密的流量服务识别

- 即该加密流量是个什么类型的流量
- 电子邮件？网页？视频？音频？图片？即时通信？还是其他什么类型

### 未知流量的处理

- 实际网络世界流量错综复杂，不可能识别出所有的流量，那么，未知流量如何处理？
- 当遇到一个新的应用或者新的网络服务时，系统能否将这些新的流量正确的归类在新的应用或服务下

## 方法 - 如何识别

> 大部分方法都只适用于特定的环境，很难采用一种方法识别所有的加密流量

### 目前的方法

- 基于数据包的特点来检测
  - 虽然理论上加密流量是完全随机的，但实际的加密过程中，在成千上万的加密流量下，流量仍然会存在一定的相似特征
  - 同时在加密的过程中，流量也不是完全随机的，其会携带部分的相同特征字段，这些字段可能不是随机的
- 在实际网络环境中，运营商会针对不同的网络业务对数据包进行一定的处理，不同业务类型的数据包大小分布也有差异
  
- 基于包的无监督学习
  - 加密技术一般只加密载荷信息，对流量本身的特征影响较小
  - 对于不同协议产生的网络流量，其传输层流级统计特征具有不同的分布

### 其他方法

- 基于不同应用的行为特征
  - 从主机的角度来分析的话，识别结果过于粗粒度
  - 从应用的角度去分析的话，识别结果过于特定，大部分的结果都限于识别特定的某个应用或某个服务
- 机器学习中的半监督学习
  - 对于校园流量，只能采用先聚类在分类的方式
  - 如果采用半监督学习的方法，那么未知应用或新网络服务产生的流量要如何识别

### 感觉不好用的方法

- 机器学习中的有监督学习
  - 网络流量受地域、时间的波动较大，非常容易出现，一个地方训练好的分类器不适用于另一个地方
  - 对于特定的校园网流量，训练出的分类器可能不适合用在其他地方
- 基于有效负载的方法
  - 直接解密加密流量存在触犯隐私权的问题，而且分析过程中开销太大，不好
  - 不解密加密流量的话，可以分析与加密流量相关的一些未加密信息，比如密钥协商流量，但信息太少，不一定有效
  - 有效负载对于应用层分析效率不高，很多应用层软件都是采用了独特的加密方法，需要一个个去寻找有效负载中的特征，只能作用于特定协议分析，无法作为广泛识别的方法
  - 有部分加密协议的报头部分实际并没有加密，可以用来进行有效负载识别，但也只能对特定协议分析，无法作为广泛识别的方法

## 论文工作

1. 数据集的清洗和整理
2. 找一个新的流模型？
   - 原本的流模型对于高速网络的抓取需要大量的包
   - 如果从
3. 根据数据集建立加密流量的精细化识别模型 - 在减少包检测数量的同时提高准确性
   1. 分析出明文流量、未知流量和加密流量
   3. 进一步分析出发出加密流量的应用是什么
   4. 最后，对于某些常见的应用，如：QQ、浏览器等，进一步探究其流量的服务是什么

## 思路 - 分层思想 - 从流的角度去考虑

### 分析包的问题

对于有些应用来说，特别是P2P应用，很可能会出现前面的N个包或nbit的包与应用特征是很大不同的

### 第一层 - 粗粒度识别

- 将流分为加密流和明文流 - **摆脱明文流量的干扰**

- 将加密流分为可识别的加密流、不可识知的加密流（即未知流）
  - 可识别的加密流：从这些流中可以提取到可以用来识别的特征
  - 不可识别的加密流：从这些流中提取不到可以用来识别的特征，或根据提取的特征无法进行识别

### 第二层 - 协议识别

- 从流的角度来考虑

### 第三层 - 应用识别

- 目前，网络应用层的加密协议主要分为两种
  - 标准化的 - 最通用的便是SSL/TLS这一种协议
  - 私有的 - 多数都是应用自身的协议，这一个在第二层便已经分出了
- 如何从SSL/TLS协议中分析出各种被加密的应用层协议？
  - 将所有流量按照应用特征进行聚类，根据聚类中心点处特征较为明显的流量包对其进行分析
  - 划定检测半径，认定在该半径内的流量包都属于该应用

### 第四层 - 服务识别

- 