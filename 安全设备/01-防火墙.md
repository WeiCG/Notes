# 防火墙

> 2021-05-11 奔跑的咸鱼

防火墙是部署在网络边界的一种安全设备，用于对网络隔离；通常会与路由器合用，甚至在除骨干路由器的位置外，其他的网络节点可以直接使用防火墙来代替

## 作用

### 保护操作系统的漏洞

- 虚拟补丁 - 对内网的服务器保护，阻止向高危端口发起的请求
- 对于更加智能的防火墙，能够检测整体流量的变化，产生报警甚至自动拦截异常的请求，及时避免网络中的操作系统受到攻击

### 阻止非法的信息流动

- 防止非法地获取数据，典型的如我国的墙
- 防止敏感数据的流出

### 限制可访问的服务或审计

- 帮助公司落地安全制度 - 公司所有对于网络的限制和要求，都可以在防火墙上实现
- 作为安全设备，防火墙的日志功能比路由器等常规设备更加完善

## 分类

### 包过滤防火墙

- 工作在网络层或传输层的防火墙，通过拦截TCP或UDP包来进行网络过滤

- 可以查看所有流经的数据包来为系统提供保护

- 使用“规则”进行过滤；防护能力较弱，只能提供基于IP地址和端口号的基本过滤能力

### 应用网关防火墙

- 已代理的模式工作在应用层，即接收客户端发来的请求，然后以客户端的身份将请求再发往服务器

- 能够获取到数据包的全部信息，实现更复杂的功能，如：内容监控、认证、协议限制甚至缓存数据包

#### 优点

- 处理信息最多，安全防护能力也最强

#### 缺点

- 会对TCP和UDP包进行解析，直接处理应用层数据，因此会对网络性能产生负面影响
- 不是所有应用都支持代理的存在，可能会对部分应用的可用性产生影响
- 服务器看到的请求都来自于代理，导致服务器无法有效的追踪请求的来源

### 状态检测防火墙

目前市面上普遍采用的，都是状态检测防火墙

- 包过滤的一种升级版，从连接的角度来看待底层的TCP和UDP数据包
- 将一连串的数据包组成一次完整的请求连接，从连接的角度看待请求，大大提高其安全性
- 不会解析将数据包解析为高层的数据，性能比应用网关防火墙更好

## 防御盲区

- 不能防御已授权服务中的恶意攻击
- 不能防御不通过防火墙的访问
- 防火墙自身存在缺陷，导致攻击者直接攻破防火墙

## WAF

WAF本质是一种特殊的应用网关防火墙，主要是因为近年来Web应用的防御越来越多，黑客的攻击目标也转移到了Web上，因此WAF逐渐被当作一个独立的产品来研究

### 工作模式

- 透明代理 - 与普通的应用网关防火墙类似，只进行HTTP流量的转发，而不做任何改变
  - 由于HTTPS流量的解密需求，WAF必须和服务器同步HTTPS对称密钥
- 反向代理
- 插件模式

### WAF的功能

- HTTP解析能力，进一步还有JSON和XML的解析能力
- Web安全防护
- 审计告警
- 数据保护和虚拟补丁