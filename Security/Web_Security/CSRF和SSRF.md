# CSRF攻击

## 概述

CSRF攻击，即Cross-Site Request Forgery，跨站点请求伪造，也被称为One Click Attack或者Session Riding。看起来非常像XSS攻击，但实际是两种不同的攻击。

- XSS攻击中，攻击者本身就是网站的信任用户
- CSRF攻击中，攻击者是通过伪造链接来伪装为信任用户，本身不是信任用户

CSRF的流行性不高，因为比较难实施，但一旦实施，破坏程度要远远大于XSS攻击

## 原理

本质：攻击者利用目标用户的身份Cookie，以目标用户的名义执行某些非法操作

原因：

- 由于HTTP请求是无连接状态的，因此网站为了与用户进行会话，发明了Session和Cookie
- Cookie保存在用户的浏览器中，当用户访问对应网页时，浏览器会将Cookie一同发送给服务器，服务器可以通过这个Cookie来验证用户的身份
- CSRF攻击时，攻击者伪造了一个对应网站的URL或指向对应网站的表单，诱使用户去点击
- 当用户点击后，浏览器会将对应网站的Cookie一同发送给服务器，此时，服务器验证Cookie，就会认为攻击者就是合法用户，就会执行操作

情景：

- 目标用户已经登录网站，能够执行网站的功能 - 即获取并保存下Cookie了
- 目标用户访问了攻击者构造的URL - 伪造了对应网站的请求且请求中包含了动作信息

## 防御手段

- 验证请求的Referer值，判断该请求来自哪里。但此方法可以被绕过，不一定可靠
- 在请求中以参数的形式加入一个随机产生的token
- 使用二次验证的方法来测试

# SSRF攻击

## 概述

SSRF攻击，即Server-Side Request Forgery，服务器端请求伪造，是一种由攻击者构造请求，由服务器端发起请求的安全漏洞

SSRF比起CSRF来说，流行度更低，因为现在的服务器很少会提供根据用户输入来请求内容的功能

## 原理

本质：服务器对用户提供了从其他服务器应用获取数据的功能但本身没有对目标地址做过滤与限制

情景：

- 对页面进行请求时，服务器会根据请求URL的某些信息对其他服务器进行请求
- 如果此时不对这些信息进行过滤或限制，可能会被攻击者利用来获取内网的信息

## 防御手段

- 限制请求的端口只能为Web端口，只允许访问HTTP和HTTPS的请求
- 限制不能访问内网IP，以防止对内网进行攻击
- 屏蔽返回的详细信息